# æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜…

## ğŸ“” åƒå¯»ç®€ç¬”è®°ä»‹ç»

åƒå¯»ç®€æ–‡åº“å·²å¼€æºï¼ŒGiteeä¸GitHubæœç´¢`chihiro-doc`ï¼ŒåŒ…å«ç¬”è®°æºæ–‡ä»¶`.md`ï¼Œä»¥åŠPDFç‰ˆæœ¬æ–¹ä¾¿é˜…è¯»ï¼Œæ–‡åº“é‡‡ç”¨ç²¾ç¾ä¸»é¢˜ï¼Œé˜…è¯»ä½“éªŒæ›´ä½³ï¼Œå¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©è¯·å¸®æˆ‘ç‚¹ä¸€ä¸ª`Star`ï½

æ›´æ–°ï¼š`æ”¯æŒåœ¨çº¿é˜…è¯»æ–‡ç« ï¼Œæ ¹æ®å‘å¸ƒæ—¥æœŸåˆ†ç±»ã€‚`

@[toc]

æ¥å…¥æŒ‡å—ï¼šhttps://opendocs.alipay.com/mini/api/requestSubscribeMessage

## ç®€ä»‹

**my.requestSubscribeMessage** å”¤èµ·å®¢æˆ·ç«¯å°ç¨‹åºæ¶ˆæ¯è®¢é˜…ç•Œé¢ã€‚

è®¢é˜…ç•Œé¢æ˜¯æ ¹æ®å½“å‰å°ç¨‹åºåœ¨ [å•†å®¶å¹³å°](https://mrchportalweb.alipay.com/operation/console/apps) é…ç½®çš„æ¶ˆæ¯æ¨¡æ¿ id æ¥å±•ç¤ºå¯¹åº”æ¶ˆæ¯çš„è®¢é˜…é€‰é¡¹ï¼ˆå‚è€ƒæ¥å…¥æµç¨‹ç¬¬ 4 æ­¥ï¼‰ã€‚

æ¶ˆæ¯è®¢é˜…åˆ†ä¸ºä¸€æ¬¡æ€§å’Œé•¿æœŸæ€§ï¼š
**ä¸€æ¬¡æ€§**ï¼šä½¿ç”¨ä¸€æ¬¡æ€§æ¶ˆæ¯æ¨¡æ¿è®¢é˜…ï¼Œæ¯æ¬¡å‘ç”¨æˆ·å‘é€æ¶ˆæ¯éƒ½éœ€è¦ç”¨æˆ·åœ¨è®¢é˜…ç•Œé¢ç‚¹å‡»åŒæ„åæ‰å¯ä»¥å‘é€ã€‚
**é•¿æœŸæ€§**ï¼šä½¿ç”¨é•¿æœŸæ€§æ¶ˆæ¯æ¨¡æ¿è®¢é˜…ï¼Œç”¨æˆ·åŒæ„è®¢é˜…åï¼Œå¯ä»¥å¤šæ¬¡å‘è®¢é˜…ç”¨æˆ·å‘é€æ¶ˆæ¯ã€‚

## ç”³è¯·æµç¨‹

### 1 å¼€å‘è®¾ç½®ï¼ˆå¼€æ”¾å¹³å°ï¼‰

**æ˜¯å¦å¿…é¡»ï¼š** æ˜¯ã€‚

ä½¿ç”¨ **ä¸»è´¦å·** ç™»å½• [å¼€æ”¾å¹³å°](https://open.alipay.com/develop/manage) ï¼Œé€‰æ‹©å½“å‰å¼€å‘çš„å°ç¨‹åºï¼Œæ ¹æ®ä¸‹é¢çš„è¯´æ˜è¿›è¡Œç›¸å…³å¼€å‘é…ç½®ï¼š

- æ¥å£åŠ ç­¾æ–¹å¼ï¼šå¿…å¡«
- åº”ç”¨ç½‘å…³ï¼šå¿…å¡«
- æ”¯ä»˜å®ç½‘å…³ï¼šå¿…å¡«
- æ¥å£å†…å®¹åŠ å¯†æ–¹å¼ï¼šé€‰å¡«ï¼Œå»ºè®®é…ç½®
- æœåŠ¡å™¨IPç™½åå•ï¼šé€‰å¡«ï¼Œæ¶‰åŠåˆ°æ•æ„Ÿæ“ä½œæ—¶å»ºè®®é…ç½®

å…·ä½“å¯å‚è€ƒæ–‡æ¡£ [å¼€å‘è®¾ç½®](https://opendocs.alipay.com/mini/01rqd3#å¼€å‘è®¾ç½®)ã€‚



### 2 é…ç½®ä¸»è¥è¡Œä¸šï¼ˆå¼€æ”¾å¹³å°ï¼‰

**æ˜¯å¦å¿…é¡»ï¼š** æ˜¯ã€‚

ä½¿ç”¨ **ä¸»è´¦å·** ç™»å½• [å¼€æ”¾å¹³å°](https://open.alipay.com/develop/manage) ï¼Œé€‰æ‹©å½“å‰å¼€å‘çš„å°ç¨‹åºï¼Œåœ¨ â€œå°ç¨‹åºä¿¡æ¯â€ ä¸­é…ç½®ä¸»è¥è¡Œä¸šï¼Œé€‰æ‹©çš„ä¸»è¥è¡Œä¸šä¸åŒï¼Œåœ¨é…ç½®æ¶ˆæ¯æ¨¡ç‰ˆï¼ˆç¬¬ 4 æ­¥ï¼‰æ—¶ï¼Œæ¥å…¥è®¢é˜…æ¶ˆæ¯æ¨¡æ¿åˆ—è¡¨å±•ç¤ºçš„æ¨¡æ¿ä¸åŒï¼Œå…·ä½“å¯å‚è€ƒæ–‡æ¡£ [é…ç½®å°ç¨‹åºä¸»è¥è¡Œä¸š](https://opendocs.alipay.com/mini/01rqd3#é…ç½®å°ç¨‹åºä¸»è¥è¡Œä¸š)ã€‚



### 3 ç»‘å®šäº§å“ï¼ˆå¼€æ”¾å¹³å°ï¼‰

**æ˜¯å¦å¿…é¡»ï¼š** æ˜¯ã€‚

æ¶ˆæ¯è®¢é˜…ä¸æ˜¯å°ç¨‹åºçš„åŸºç¡€ API ï¼Œéœ€è¦åœ¨ [å¼€æ”¾å¹³å°](https://open.alipay.com/develop/manage) ç»‘å®šäº§å“çš„åˆ—è¡¨ä¸­ï¼Œç»™äº§å“ **å°ç¨‹åº** ç»‘å®š **æ¶ˆæ¯** æƒé™ã€‚å…·ä½“å¯å‚è€ƒæ–‡æ¡£ [äº§å“ç»‘å®š](https://opendocs.alipay.com/mini/01rqd3#äº§å“ç»‘å®š)ã€‚



### 4 é…ç½®æ¶ˆæ¯æ¨¡æ¿ï¼ˆå•†å®¶å¹³å°ï¼‰

**æ˜¯å¦å¿…é¡»ï¼š** æ˜¯ã€‚

ä½¿ç”¨ **ä¸»è´¦å·** ç™»å½• [å•†å®¶å¹³å°](https://mrchportalweb.alipay.com/operation/console/apps)ï¼Œé€‰æ‹©å½“å‰å¼€å‘çš„å°ç¨‹åºè¿›è¡Œé…ç½®ï¼Œå…·ä½“å¯å‚è€ƒæ–‡æ¡£ [é¢†ç”¨è®¢é˜…æ¶ˆæ¯æ¨¡æ¿](https://opendocs.alipay.com/mini/01rnqx#ç¬¬ä¸€æ­¥ï¼šé¢†ç”¨è®¢é˜…æ¶ˆæ¯æ¨¡æ¿)ã€‚



### 5 APIè°ƒç”¨ï¼ˆå°ç¨‹åºï¼‰

**æ˜¯å¦å¿…é¡»ï¼š** æ˜¯ã€‚

åœ¨å°ç¨‹åºä¸­è°ƒç”¨ API ï¼Œå‚æ•°å±æ€§ entityIds ä¸­ä¼ å…¥é¢†ç”¨çš„æ¶ˆæ¯æ¨¡ç‰ˆ idï¼ˆæœ€å¤šä¸‰ä¸ªï¼‰ï¼Œè°ƒç”¨åå¼¹å‡ºè®¢é˜…ç•Œé¢ã€‚æŸ¥çœ‹ç¤ºä¾‹ã€‚



### 6 å‘é€æ¶ˆæ¯ï¼ˆæœåŠ¡ç«¯ï¼‰

**æ˜¯å¦å¿…é¡»ï¼š** æ˜¯ã€‚

åœ¨ç”¨æˆ·æˆæƒå®Œæˆï¼ˆå¼€å‘æ¥å…¥å®Œæˆï¼‰ä¹‹åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å‘é€æ¶ˆæ¯ï¼š

1. é€šè¿‡æœåŠ¡ç«¯è°ƒç”¨ [alipay.open.app.mini.templatemessage.send](https://opendocs.alipay.com/mini/02cth2) å‘æ”¯ä»˜å®å‘é€å¯¹åº”æ¨¡æ¿çš„æ¶ˆæ¯ã€‚
2. é€šè¿‡ **ä¸»è´¦å·** ç™»å½• [å•†å®¶å¹³å°](https://mrchportalweb.alipay.com/operation/console/apps)ï¼Œè¿›å…¥ **è¿è¥ä¸­å¿ƒ** é€‰æ‹©å¯¹åº”å°ç¨‹åºï¼Œç‚¹å‡»å·¦ä¾§èœå•ä¸­çš„ â€æ¶ˆæ¯â€œï¼Œåœ¨è®¢é˜…æ¶ˆæ¯åˆ—è¡¨ä¸­ï¼Œç”¨ â€œé…ç½®å‘é€â€ å‘é€æ¶ˆæ¯ï¼Œæ— éœ€æœåŠ¡ç«¯ç¼–å†™ä»£ç ã€‚

è®¢é˜…æ¶ˆæ¯å‘é€åï¼Œå¯åœ¨ **æ”¯ä»˜å®é¦–é¡µ ã€æ¶ˆæ¯ç›’å­ã€APP PUSH** ç­‰ä½ç½®æ”¶åˆ°æ¶ˆæ¯æé†’ã€‚



## è¯¦ç»†æ•™ç¨‹

### 1 å¼€å‘è®¾ç½®ï¼ˆå¼€æ”¾å¹³å°ï¼‰

åœ¨ **å¼€å‘** > **å¼€å‘è®¾ç½®** ä¸­é…ç½®åº”ç”¨ä¿¡æ¯ã€‚

![å°ç¨‹åºå¼€å‘è®¾ç½®.jpg](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658401787544-41619765-ef00-458f-aaa9-1b8837a74f7e.jpeg)

#### æ¥å£åŠ ç­¾æ–¹å¼

**å¿…å¡«ã€‚**ç”¨äºé˜²æ­¢æ•°æ®ç¯¡æ”¹ï¼Œä¿éšœåº”ç”¨å’Œæ”¯ä»˜å®äº¤äº’çš„å®‰å…¨æ€§ï¼Œå¯æŸ¥çœ‹ [æ¥å£åŠ ç­¾æ–¹å¼](https://opendocs.alipay.com/common/02mriz)ã€‚

**è¯´æ˜**ï¼šè‹¥äº§å“æ¶‰åŠ [èµ„é‡‘æ”¯å‡ºçš„æ¥å£](https://opendocs.alipay.com/common/02kg66) å¿…é¡» [è®¾ç½®è¯ä¹¦åŠ ç­¾æ–¹å¼](https://opendocs.alipay.com/common/02kdnc#å…¬é’¥è¯ä¹¦æ–¹å¼_2)ã€‚

![æˆªå±2022-11-21 11.18.11.png](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1669000743526-d67d2be5-2c39-4c59-b8aa-bd8f98070aa0.png)

#### æœåŠ¡å™¨ IP ç™½åå•

**é€‰å¡«ã€‚**ç”¨äºæé«˜åº”ç”¨è®¿é—®å¼€æ”¾å¹³å°çš„å®‰å…¨æ€§ï¼Œé¿å…å› åº”ç”¨ç§é’¥æ³„æ¼ç­‰åŸå› å¯¼è‡´ä¸šåŠ¡å—æŸï¼Œä¿éšœç”¨æˆ·èµ„é‡‘å®‰å…¨ï¼Œå¯æŸ¥çœ‹ [æœåŠ¡å™¨ IP ç™½åå•](https://opendocs.alipay.com/common/02kg65)ã€‚

![IPç™½åå•.png](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658400829561-01f1d120-1c55-4445-9ac2-bc8830ce8518.png)

#### æ”¯ä»˜å®ç½‘å…³

**å¿…å¡«ã€‚**å¼€å‘è€…è°ƒç”¨ OpenAPI å‘é€ http(s) è¯·æ±‚è‡³æ”¯ä»˜å®çš„ç›®æ ‡åœ°å€ï¼ˆgatewayï¼‰ï¼Œå›ºå®šä¸º `https://openapi.alipay.com/gateway.do`ã€‚

#### åº”ç”¨ç½‘å…³

**å¿…å¡«ã€‚**ç”¨äºæ¥æ”¶æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥æ¶ˆæ¯ï¼Œéœ€è¦ä¼ å…¥ http(s) å…¬ç½‘å¯è®¿é—®ç½‘é¡µåœ°å€ï¼Œå¯æŸ¥çœ‹ [åº”ç”¨ç½‘å…³](https://opendocs.alipay.com/common/02qibh)ã€‚

![image](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1657605518437-59db9082-a7a8-4a4a-917e-9243a97c3d1e.png)

#### æ¥å£å†…å®¹åŠ å¯†æ–¹å¼

**é€‰å¡«ã€‚**ç”¨äºåŠ  / è§£å¯† OpenAPI bizContent æŠ¥æ–‡å†…å®¹ï¼Œå¯å¤§å¹…æå‡æ¥å£å†…å®¹ä¼ è¾“çš„å®‰å…¨æ€§ã€‚å¯æŸ¥çœ‹ [æ¥å£å†…å®¹åŠ å¯†æ–¹å¼](https://opendocs.alipay.com/common/02mse3)ã€‚

![image](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1657605528738-eb114e87-e369-4b52-a8b4-3bef7d305e03.png)

#### æœåŠ¡å™¨åŸŸåç™½åå•

**é€‰å¡«**ã€‚**å°ç¨‹åº** è‹¥éœ€è¦è·å–å®¢æˆ·ç«¯åŸŸå¤–èµ„æºï¼ˆä¾‹å¦‚è·å–å›¾ç‰‡ã€æœåŠ¡ç«¯æ•°æ®ç­‰ï¼‰ï¼Œéœ€è¦é…ç½®æœåŠ¡å™¨åŸŸåç™½åå•ã€‚

![æœåŠ¡å™¨åŸŸåç™½åå•.png](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658401352820-fede08a5-2937-4be8-a51e-a5874ded08be.png)



### 2 é…ç½®ä¸»è¥è¡Œä¸šï¼ˆå¼€æ”¾å¹³å°ï¼‰

è¿›å…¥å°ç¨‹åºè¯¦æƒ…é¡µ > **åŸºç¡€è®¾ç½®** > **å°ç¨‹åºä¿¡æ¯ï¼Œ**ç‚¹å‡» **ç¼–è¾‘** æŒ‰é’®è¡¥å…… **ä¸»è¥è¡Œä¸š**ã€‚

**è¯´æ˜ï¼š**ä¸åŒå°ç¨‹åºä¸»è¥è¡Œä¸šå±•ç¤ºçš„æ¨¡æ¿åº“åˆ—è¡¨ä¸åŒã€‚

![å°ç¨‹åºä¿¡æ¯.jpg](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658402373692-0a476386-5deb-48a5-aba1-f8c30b241d99.jpeg)



### 3 ç»‘å®šäº§å“ï¼ˆå¼€æ”¾å¹³å°ï¼‰

1. åˆ›å»ºåº”ç”¨åï¼Œåœ¨ **å¼€å‘** > **äº§å“ç»‘å®š** > **ç»‘å®šäº§å“** > æ‰¾åˆ° **å°ç¨‹åº**ï¼Œç‚¹å‡» **ä¿®æ”¹**ã€‚
   ![1.jpg](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658400672411-fd9ea321-2344-4763-a0c9-997fc82c5c6a.jpeg)
2. åœ¨æƒé™é›†ä¸­å‹¾é€‰ **æ¶ˆæ¯**ï¼Œç‚¹å‡» **ç¡®å®š**ã€‚
   ![2.jpg](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658400689606-9b0c0500-644a-496b-a816-3cba92df2e96.jpeg)
3. åœ¨é€‰æ‹©äº§å“é¡µé¢ï¼Œç‚¹å‡» **ç¡®å®š**ï¼Œå®Œæˆäº§å“ç»‘å®šã€‚
   ![3.jpg](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1658400708334-fcb9e4ea-7d06-4e79-b22c-18b8fca39c7a.jpeg)



### 4 é…ç½®æ¶ˆæ¯æ¨¡æ¿ï¼ˆå•†å®¶å¹³å°ï¼‰

1. ç™»å½• **æ”¯ä»˜å®å•†å®¶å¹³å°** > **è¿è¥ä¸­å¿ƒ** > [å°ç¨‹åº](https://mrchportalweb.alipay.com/operation/console/apps)ï¼Œåœ¨ **æˆ‘çš„å°ç¨‹åº** ç‚¹å‡»éœ€è¦æ¥å…¥æ¶ˆæ¯çš„å°ç¨‹åºã€‚ 
   ![image.png](https://cdn.nlark.com/yuque/0/2022/png/179989/1661406398821-6478cf09-ad2f-41ab-87f7-4acb833b59fe.png)
2. ç‚¹å‡»å·¦ä¾§ **å¬å›** > **æ¶ˆæ¯**ï¼Œè¿›å…¥å°ç¨‹åºæ¶ˆæ¯é¡µé¢é€‰æ‹©æ¥å…¥è®¢é˜…æ¶ˆæ¯ï¼Œç‚¹å‡» **å»æ¥å…¥**ã€‚
   ![image.png](https://cdn.nlark.com/yuque/0/2022/png/179989/1661406517790-a3ec3f00-da56-452b-a610-3b6627fc93bb.png)
3. è¿›å…¥æ¥å…¥è®¢é˜…æ¶ˆæ¯æ¨¡æ¿é¡µé¢ï¼Œå¯æ ¹æ®è‡ªèº«è¡Œä¸šç±»å‹é€‰æ‹©å¯¹åº” **è¡Œä¸š** ä¸‹çš„æ¶ˆæ¯æ¨¡æ¿ï¼Œä¹Ÿå¯æ ¹æ®è®¢é˜…ç±»å‹ **ä¸€æ¬¡æ€§è®¢é˜…**ã€**é•¿æœŸè®¢é˜…** æ¥é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿ï¼Œè¿˜å¯åœ¨æœç´¢æ¡†ä¸­æœç´¢æ‰€éœ€æ¨¡æ¿å…³é”®å­—ï¼ŒæŸ¥è¯¢ç›¸å…³æ¶ˆæ¯æ¨¡æ¿ã€‚è‹¥æ— åˆé€‚çš„æ¨¡æ¿ä¹Ÿå¯ç‚¹å‡» **åˆ›å»ºæ¨¡æ¿**ï¼Œç”³è¯·æ–°æ¨¡æ¿ï¼Œå®¡æ ¸é€šè¿‡åä¹Ÿå¯åšé¢†ç”¨ã€‚**æ³¨æ„**ï¼šå°ç¨‹åºä¸åŒä¸»è¥è¡Œä¸šå±•ç¤ºçš„æ¨¡æ¿åº“åˆ—è¡¨ä¸åŒï¼Œä¾‹å¦‚ï¼šé“¶è¡Œè¡Œä¸šä¸ä¼šå±•ç¤ºå–é¤æé†’æ¨¡æ¿ã€‚
   ![image.png](https://cdn.nlark.com/yuque/0/2022/png/179989/1661406655331-1f3f7780-138d-40c5-a491-4fb8d4161780.png)
4. é€‰æ‹©æ¨¡æ¿åï¼Œé…ç½®å…³é”®è¯åŠé¡ºåºã€‚
   **è¯´æ˜**ï¼šå³ä¾§ç¤ºä¾‹å›¾ä¼šå®æ—¶å±•ç¤ºè¯¥è®¢é˜…æ¶ˆæ¯åœ¨ç”¨æˆ·ç•Œé¢æ•ˆæœã€‚
   ![7.png](https://cdn.nlark.com/yuque/0/2022/png/179989/1656574902136-98a6f299-ed44-4886-9d72-654c7d4f2c06.png)
5. å®Œæˆæ¶ˆæ¯æ¨¡æ¿é…ç½®åï¼Œå¯ç‚¹å‡» **ç«‹å³æ¥å…¥**ï¼Œè¿›è¡ŒæŠ€æœ¯å¯¹æ¥ã€‚
   ![8.png](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1656574916203-2cc4b0ad-1e12-481f-9fde-cfa059fbedca.png)



### 5 APIè°ƒç”¨ï¼ˆå°ç¨‹åºï¼‰

#### ä»£ç ç¤ºä¾‹

`my.requestSubscribeMessage(Object object)`

```js
my.requestSubscribeMessage({
  entityIds: [
    'ac768fca1ce245ccae9404bb5243c49b',
    '9aa357acb7c6434aba294aded1cdfb7c',
  ],
  success: res => {
    console.log('æ¥å£è°ƒç”¨æˆåŠŸçš„å›è°ƒ', res);
  },
  fail: err => {
    console.log('æ¥å£è°ƒç”¨å¤±è´¥çš„å›è°ƒ', err);
  }
});
```

`success` å‚æ•°

```json
{
  "success": true,
  "stat": "ok",
  "behavior": "subscribe",
  "result": {
    "subscribeEntityIds": [
      "cbc3487d54a648e0b38e334b2b047dd3"
    ],
    "subscribedEntityIds": [
      "cbc3487d54a648e0b38e334b2b047dd3"
    ],
    "unsubscribedEntityIds": [],
    "currentSubscribedEntityIds": [
      "cbc3487d54a648e0b38e334b2b047dd3"
    ]
  },
  "show": true,
  "keep": false,
  "refuse": false,
  "cbc3487d54a648e0b38e334b2b047dd3": "accept"
}
```

`fail` å‚æ•°

```json
{
  "success": false,
  "stat": "ok",
  "behavior": "cancel",
  "result": {
    "entityList": [
      "cbc3487d54a648e0b38e334b2b047dd3"
    ], 
    "subscribedEntityIds": [],
    "unsubscribedEntityIds": [
      "cbc3487d54a648e0b38e334b2b047dd3"
    ],
    "currentSubscribedEntityIds": []
  },
  "show": true,
  "keep": true,
  "refuse": false,
  "error": 11,
  "errorCode": 11,
  "errorMessage": "ç”¨æˆ·å–æ¶ˆè®¢é˜…",
  "cbc3487d54a648e0b38e334b2b047dd3": "accept"
}
```

> entityList æ˜¯ä¼ å…¥çš„æ¨¡æ¿ id é›†åˆï¼Œä»…åœ¨å–æ¶ˆè®¢é˜…åœºæ™¯ä¸‹è¿”å›ã€‚



### 6 å‘é€æ¶ˆæ¯ï¼ˆæœåŠ¡ç«¯ï¼‰

#### å‘é€è®¢é˜…æ¶ˆæ¯

å½“å°ç¨‹åºç”¨æˆ·åŸºäºæ¶ˆæ¯è®¢é˜…æ¥å£äº§ç”Ÿè®¢é˜…è¡Œä¸ºåï¼Œå¼€å‘è€…å¯è°ƒç”¨ [alipay.open.app.mini.templatemessage.sendï¼ˆå°ç¨‹åºå‘é€æ¨¡æ¿æ¶ˆæ¯ï¼‰](https://opendocs.alipay.com/mini/6430ce5a_alipay.open.app.mini.templatemessage.send)ï¼Œå‘è®¢é˜…æ¨¡æ¿çš„ç”¨æˆ·å‘é€æ¨¡æ¿æ¶ˆæ¯ã€‚

**è¯´æ˜**ï¼šé’ˆå¯¹å†…å®¹ä¸€è‡´ã€å¯ä»¥æ™®å‘ç»™ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œè¿˜æ”¯æŒå…ä»£ç å¼€å‘çš„æ–¹å¼å‘é€ï¼Œå•†å®¶å¯åœ¨ [æ¶ˆæ¯è¿è¥](https://mrchportalweb.alipay.com/operation/mini/ops/publicmsg/msgTemplateV2/myTemplate) > **æ¶ˆæ¯æ¥å…¥** > **è®¢é˜…æ¶ˆæ¯** > **æ‰¹é‡å‘é€** è¿›è¡Œæ“ä½œã€‚

##### è°ƒç”¨æµç¨‹å›¾

<img src="æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/1656575266830-81aa8348-dd02-43ee-83bb-80dd78ded911.png" alt="æœåŠ¡ç«¯.png" style="zoom:80%;" />

##### ç¤ºä¾‹ä»£ç 

```java
package com.java.sdk.demo;

import com.alipay.api.AlipayApiException;
import com.alipay.api.AlipayClient;
import com.alipay.api.DefaultAlipayClient;
import com.alipay.api.CertAlipayRequest;
import com.alipay.api.AlipayConfig;
import com.alipay.api.domain.AlipayOpenAppMiniTemplatemessageSendModel;
import com.alipay.api.response.AlipayOpenAppMiniTemplatemessageSendResponse;
import com.alipay.api.request.AlipayOpenAppMiniTemplatemessageSendRequest;
import com.alipay.api.FileItem;
import java.util.Base64;
import java.util.ArrayList;
import java.util.List;

public class AlipayOpenAppMiniTemplatemessageSend {

    public static void main(String[] args) throws AlipayApiException {
        String privateKey = "<-- è¯·å¡«å†™æ‚¨çš„åº”ç”¨ç§é’¥ï¼Œä¾‹å¦‚ï¼šMIIEvQIBADANB ... ... -->";
        String alipayPublicKey = "<-- è¯·å¡«å†™æ‚¨çš„æ”¯ä»˜å®å…¬é’¥ï¼Œä¾‹å¦‚ï¼šMIIBIjANBg... -->";
        AlipayConfig alipayConfig = new AlipayConfig();
        alipayConfig.setServerUrl("https://openapi.alipay.com/gateway.do");
        alipayConfig.setAppId("<-- è¯·å¡«å†™æ‚¨çš„AppIdï¼Œä¾‹å¦‚ï¼š2019091767145019 -->");
        alipayConfig.setPrivateKey(privateKey);
        alipayConfig.setFormat("json");
        alipayConfig.setAlipayPublicKey(alipayPublicKey);
        alipayConfig.setCharset("UTF8");
        alipayConfig.setSignType("RSA2");
        AlipayClient alipayClient = new DefaultAlipayClient(alipayConfig);
        AlipayOpenAppMiniTemplatemessageSendRequest request = new AlipayOpenAppMiniTemplatemessageSendRequest();
        AlipayOpenAppMiniTemplatemessageSendModel model = new AlipayOpenAppMiniTemplatemessageSendModel();
        model.setFormId("2017010100000000580012345678");
        model.setData("{\"keyword1\": {\"value\" : \"12:00\"},\"keyword2\": {\"value\" : \"20180808\"},\"keyword3\": {\"value\" : \"æ”¯ä»˜å®\"}}");
        model.setPage("page/component/index");
        model.setUserTemplateId("MDI4YzIxMDE2M2I5YTQzYjUxNWE4MjA4NmU1MTIyYmM=");
        model.setToUserId("2088102122458832");
        request.setBizModel(model);
        AlipayOpenAppMiniTemplatemessageSendResponse response = alipayClient.execute(request);
        System.out.println(response.getBody());
        if (response.isSuccess()) {
            System.out.println("è°ƒç”¨æˆåŠŸ");
        } else {
            System.out.println("è°ƒç”¨å¤±è´¥");
            // sdkç‰ˆæœ¬æ˜¯"4.38.0.ALL"åŠä»¥ä¸Š,å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹è·å–è¯Šæ–­é“¾æ¥
            // String diagnosisUrl = DiagnosisUtils.getDiagnosisUrl(response);
            // System.out.println(diagnosisUrl);
        }
    }
}
```

é‡è¦å…¥å‚è¯´æ˜ï¼š

- to_user_idï¼šå¿…å¡«ï¼Œæ¥æ”¶æ¨¡æ¿æ¶ˆæ¯ç”¨æˆ·æ”¯ä»˜å® user_idï¼Œå¯é€šè¿‡ [ç”¨æˆ·æˆæƒ](https://opendocs.alipay.com/mini/api/openapi-authorize) è·å–ã€‚
- user_template_idï¼šå¿…å¡«ï¼Œæ¶ˆæ¯æ¨¡æ¿ IDã€‚ç™»å½• [è¿è¥ä¸­å¿ƒ                                                               ](https://business.alipay.com/) è¿›å…¥æ¶ˆæ¯è¿è¥æ·»åŠ è®¢é˜…ä¿¡æ¯åç‚¹è¯¦æƒ…å³å¯çœ‹åˆ°ï¼Œè¯¦æƒ…å¯æŸ¥çœ‹ä¸Šæ–‡ **é€‰ç”¨æ¶ˆæ¯æ¨¡æ¿**ã€‚
- pageï¼šå¿…å¡«ï¼Œæ¨¡æ¿æ¶ˆæ¯ **è¿›å…¥å°ç¨‹åºæŸ¥çœ‹** æŒ‰é’®è·³è½¬çš„å°ç¨‹åºé¡µé¢åœ°å€ã€‚
- dataï¼šå¿…å¡«ï¼Œå¼€å‘è€…éœ€è¦å‘é€æ¨¡æ¿æ¶ˆæ¯ä¸­çš„è‡ªå®šä¹‰éƒ¨åˆ†æ¥æ›¿æ¢æ¨¡æ¿çš„å ä½ç¬¦

> æ³¨æ„ï¼šå ä½ç¬¦å¿…é¡»å’Œç”³è¯·æ¨¡æ¿æ—¶çš„å…³é”®è¯ä¸€ä¸€åŒ¹é…ï¼ˆåŒ…æ‹¬é¡ºåºï¼‰ã€‚

#### æŸ¥è¯¢æ¶ˆæ¯è®¢é˜…å…³ç³»

å¼€å‘è€…å¯è°ƒç”¨ [alipay.open.app.messagetemplate.subscribe.queryï¼ˆæ¨¡æ¿è®¢é˜…å…³ç³»æŸ¥è¯¢ï¼‰](https://opendocs.alipay.com/mini/69b7fd23_alipay.open.app.messagetemplate.subscribe.query)ï¼Œæå‰æŸ¥è¯¢ç”¨æˆ·å¯¹æŒ‡å®šæ¶ˆæ¯æ¨¡æ¿çš„è®¢é˜…å…³ç³»ï¼Œå†æ ¹æ®è®¢é˜…å…³ç³»å¼•å¯¼ç”¨æˆ·è¿›è¡Œè®¢é˜…å’Œç²¾å‡†è§¦è¾¾æ¶ˆæ¯ã€‚

**è¯´æ˜**ï¼šè‹¥å¼€å‘è€…æƒ³å®ç°å»è®¢é˜…ç±»å‹çš„å¼•å¯¼åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡æœ¬æ¥å£è¿›è¡Œè®¢é˜…å…³ç³»åˆ¤æ–­ï¼Œæ ¹æ®å“åº”ç»“æœå±•ç¤ºå¼•å¯¼æ–‡æ¡ˆã€‚

##### ç¤ºä¾‹ä»£ç 

```java
package com.java.sdk.demo;

import com.alipay.api.AlipayApiException;
import com.alipay.api.AlipayClient;
import com.alipay.api.DefaultAlipayClient;
import com.alipay.api.CertAlipayRequest;
import com.alipay.api.AlipayConfig;
import com.alipay.api.domain.AlipayOpenAppMessagetemplateSubscribeQueryModel;
import com.alipay.api.response.AlipayOpenAppMessagetemplateSubscribeQueryResponse;
import com.alipay.api.request.AlipayOpenAppMessagetemplateSubscribeQueryRequest;
import com.alipay.api.FileItem;
import java.util.Base64;
import java.util.ArrayList;
import java.util.List;

public class AlipayOpenAppMessagetemplateSubscribeQuery {

    public static void main(String[] args) throws AlipayApiException {
        String privateKey = "<-- è¯·å¡«å†™æ‚¨çš„åº”ç”¨ç§é’¥ï¼Œä¾‹å¦‚ï¼šMIIEvQIBADANB ... ... -->";
        String alipayPublicKey = "<-- è¯·å¡«å†™æ‚¨çš„æ”¯ä»˜å®å…¬é’¥ï¼Œä¾‹å¦‚ï¼šMIIBIjANBg... -->";
        AlipayConfig alipayConfig = new AlipayConfig();
        alipayConfig.setServerUrl("https://openapi.alipay.com/gateway.do");
        alipayConfig.setAppId("<-- è¯·å¡«å†™æ‚¨çš„AppIdï¼Œä¾‹å¦‚ï¼š2019091767145019 -->");
        alipayConfig.setPrivateKey(privateKey);
        alipayConfig.setFormat("json");
        alipayConfig.setAlipayPublicKey(alipayPublicKey);
        alipayConfig.setCharset("UTF8");
        alipayConfig.setSignType("RSA2");
        AlipayClient alipayClient = new DefaultAlipayClient(alipayConfig);
        AlipayOpenAppMessagetemplateSubscribeQueryRequest request = new AlipayOpenAppMessagetemplateSubscribeQueryRequest();
        AlipayOpenAppMessagetemplateSubscribeQueryModel model = new AlipayOpenAppMessagetemplateSubscribeQueryModel();
        List<String> templateIdList = new ArrayList<String>();
        templateIdList.add("6511999536b14ba5830e3a0289ea69a");
        templateIdList.add("0b1fcca882aa435382ae98641e14d37");
        templateIdList.add("a3b396be6fd345579221af5dea35028");
        model.setTemplateIdList(templateIdList);
        model.setUserId("2088202882050410");
        request.setBizModel(model);
        AlipayOpenAppMessagetemplateSubscribeQueryResponse response = alipayClient.execute(request);
        System.out.println(response.getBody());
        if (response.isSuccess()) {
            System.out.println("è°ƒç”¨æˆåŠŸ");
        } else {
            System.out.println("è°ƒç”¨å¤±è´¥");
        }
    }
}
```

##### é‡è¦å…¥å‚è¯´æ˜

- user_idï¼šå¿…å¡«ï¼Œæ¥æ”¶æ¨¡æ¿æ¶ˆæ¯çš„ç”¨æˆ·æ”¯ä»˜å® user_idï¼Œå¯é€šè¿‡ [my.getAuthCode](https://opendocs.alipay.com/mini/api/openapi-authorize) è·å–ã€‚
- template_id_listï¼šæ¶ˆæ¯æ¨¡æ¿ id åˆ—è¡¨ï¼Œæœ€å¤šä¸è¶…è¿‡ 3 ä¸ªã€‚æ¨¡æ¿ id éœ€è¦ä¿æŒåŒä¸€ä¸ªåº”ç”¨ä¸»ä½“ï¼Œå¹¶ä¸”å±•ç¤ºåœ¨åŒä¸€ä¸ªè®¢é˜…çª—å£ä¸­çš„æ¨¡æ¿ idã€‚

## é‡åˆ°çš„é—®é¢˜

### ISVæƒé™ä¸è¶³

å»å¼€æ”¾å¹³å°ç»‘å®šäº§å“ï¼šæ¶ˆæ¯

![image-20230718153728218](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/image-20230718153728218.png)

![image-20230718153744276](æ”¯ä»˜å®æ¶ˆæ¯è®¢é˜….assets/image-20230718153744276.png)

